<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Portfolio — Executive Summary</title>
    <style>
        @page { size: letter; margin: 0.5in; }

        :root {
            --slate-900: #0f172a;
            --slate-700: #334155;
            --slate-500: #64748b;
            --slate-300: #cbd5e1;
            --slate-100: #f1f5f9;
            --slate-50:  #f8fafc;
            --purple:    #7c3aed;
            --purple-bg: #ede9fe;
            --blue:      #2563eb;
            --blue-bg:   #dbeafe;
            --green:     #059669;
            --green-bg:  #d1fae5;
            --accent:    #1a56db;
            --bg:        #ffffff;
            --card-bg:   #ffffff;
        }

        /* ── Dark Mode ── */
        [data-theme="dark"] {
            --slate-900: #f1f5f9;
            --slate-700: #cbd5e1;
            --slate-500: #94a3b8;
            --slate-300: #334155;
            --slate-100: #1e293b;
            --slate-50:  #0f172a;
            --purple:    #a78bfa;
            --purple-bg: #2e1065;
            --blue:      #60a5fa;
            --blue-bg:   #1e3a5f;
            --green:     #34d399;
            --green-bg:  #064e3b;
            --accent:    #60a5fa;
            --bg:        #0b1120;
            --card-bg:   #162032;
        }
        [data-theme="dark"] .page-header { border-bottom-color: #334155; }
        [data-theme="dark"] .portfolio-table thead th { background: #1e293b; color: #e2e8f0; }
        [data-theme="dark"] .pipeline-card:hover { box-shadow: 0 3px 8px rgba(0,0,0,.3); }
        [data-theme="dark"] .export-btn:hover { color: #fff; }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--slate-900);
            background: var(--bg);
            line-height: 1.45;
            font-size: 14px;
            max-width: 1000px;
            margin: 0 auto;
            padding: 32px 40px;
        }

        /* ── Header ── */
        .page-header {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            border-bottom: 3px solid var(--slate-900);
            padding-bottom: 14px;
            margin-bottom: 24px;
        }
        .page-header h1 {
            font-size: 1.65rem;
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        .page-header h1 span { color: var(--accent); }
        .page-header .date { font-size: 0.82rem; color: var(--slate-500); font-weight: 500; }

        /* ── KPI Strip ── */
        .kpi-strip {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 26px;
        }
        .kpi-box {
            background: var(--slate-50);
            border: 1px solid var(--slate-300);
            border-radius: 8px;
            padding: 16px 18px;
            text-align: center;
        }
        .kpi-box .number {
            font-size: 1.85rem;
            font-weight: 800;
            line-height: 1.1;
            color: var(--accent);
        }
        .kpi-box .label {
            font-size: 0.78rem;
            color: var(--slate-500);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            font-weight: 600;
            margin-top: 4px;
        }

        /* ── Pipeline Board ── */
        .pipeline-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-bottom: 26px;
        }
        .pipeline-col {
            background: var(--slate-50);
            border: 1px solid var(--slate-300);
            border-radius: 8px;
            overflow: hidden;
        }
        .pipeline-col-header {
            padding: 10px 14px;
            font-size: 0.76rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .pipeline-col-header .col-count {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 0.72rem;
            font-weight: 800;
        }
        .pipeline-col.col-prod .pipeline-col-header {
            background: var(--purple);
            color: #fff;
        }
        .pipeline-col.col-prod .col-count {
            background: rgba(255,255,255,.25);
            color: #fff;
        }
        .pipeline-col.col-done .pipeline-col-header {
            background: var(--blue);
            color: #fff;
        }
        .pipeline-col.col-done .col-count {
            background: rgba(255,255,255,.25);
            color: #fff;
        }
        .pipeline-col.col-prog .pipeline-col-header {
            background: var(--green);
            color: #fff;
        }
        .pipeline-col.col-prog .col-count {
            background: rgba(255,255,255,.25);
            color: #fff;
        }
        .pipeline-col-body {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .pipeline-card {
            background: var(--card-bg);
            border: 1px solid var(--slate-300);
            border-radius: 6px;
            padding: 12px 14px;
            transition: box-shadow .15s, transform .15s;
        }
        .pipeline-card:hover {
            box-shadow: 0 3px 8px rgba(0,0,0,.08);
            transform: translateY(-1px);
        }
        .pipeline-card-name {
            font-size: 0.88rem;
            font-weight: 700;
            color: var(--slate-900);
            margin-bottom: 6px;
        }
        .pipeline-card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        .pipeline-card-dept {
            display: inline-block;
            padding: 2px 9px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--slate-100);
            color: var(--slate-500);
        }
        .pipeline-card-owner {
            font-size: 0.75rem;
            color: var(--slate-500);
            font-weight: 500;
            white-space: nowrap;
        }

        /* ── Section Headings ── */
        .section-title {
            font-size: 0.88rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--slate-700);
            border-bottom: 2px solid var(--slate-300);
            padding-bottom: 6px;
            margin-bottom: 14px;
        }

        /* ── Portfolio Table ── */
        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 26px;
            font-size: 0.84rem;
        }
        .portfolio-table thead th {
            background: #0f172a;
            color: #fff;
            padding: 9px 12px;
            text-align: left;
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }
        .portfolio-table thead th:first-child { border-radius: 6px 0 0 0; }
        .portfolio-table thead th:last-child  { border-radius: 0 6px 0 0; }
        .portfolio-table tbody td {
            padding: 9px 12px;
            border-bottom: 1px solid var(--slate-300);
            vertical-align: middle;
        }
        .portfolio-table tbody tr:last-child td { border-bottom: none; }
        .portfolio-table tbody tr:nth-child(even) td { background: var(--slate-50); }

        .badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .badge-prod { background: var(--purple-bg); color: var(--purple); }
        .badge-done { background: var(--blue-bg);  color: var(--blue); }
        .badge-prog { background: var(--green-bg); color: var(--green); }

        /* ── Highlights ── */
        .highlights-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 26px;
        }
        .highlight-card {
            border-radius: 8px;
            padding: 16px 18px;
            border-left: 4px solid var(--accent);
            background: var(--slate-50);
        }
        .highlight-card h4 {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--slate-900);
        }
        .highlight-card p {
            font-size: 0.8rem;
            color: var(--slate-500);
            line-height: 1.45;
        }
        .highlight-card .stat {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 4px;
        }

        /* ── Recommendations ── */
        .reco-list {
            list-style: none;
            padding: 0;
            margin: 0 0 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 24px;
        }
        .reco-list li {
            font-size: 0.82rem;
            color: var(--slate-700);
            padding: 6px 0 6px 20px;
            position: relative;
            line-height: 1.4;
        }
        .reco-list li::before {
            content: "\25B8";
            position: absolute;
            left: 4px;
            color: var(--accent);
            font-weight: 700;
        }

        /* ── Footer ── */
        .page-footer {
            border-top: 1px solid var(--slate-300);
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 0.72rem;
            color: var(--slate-500);
        }

        /* ── Print ── */
        @media print {
            body { padding: 0; font-size: 13px; max-width: none; }
            .kpi-box .number { font-size: 1.6rem; }
            .highlight-card, .kpi-box, .pipeline-card { break-inside: avoid; }
            .pipeline-board { gap: 12px; }
            .pipeline-card:hover { box-shadow: none; transform: none; }
            .export-btn { display: none !important; }
            .theme-toggle { display: none !important; }
        }
        /* ── Theme Toggle ── */
        .theme-toggle {
            background: var(--slate-100);
            border: 1px solid var(--slate-300);
            border-radius: 20px;
            padding: 6px 12px;
            cursor: pointer;
            color: var(--slate-500);
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background .2s, color .2s, border-color .2s;
        }
        .theme-toggle:hover { color: var(--accent); }
        .theme-toggle svg { width: 14px; height: 14px; }

        /* ── Export Buttons ── */
        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--slate-500);
            background: var(--slate-50);
            border: 1px solid var(--slate-300);
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            float: right;
            transition: background .15s, color .15s;
        }
        .export-btn:hover { background: var(--accent); color: #fff; border-color: var(--accent); }
        .export-btn svg { width: 14px; height: 14px; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<script>
/* Apply saved theme immediately to prevent flash */
(function() {
    const saved = localStorage.getItem("theme");
    if (saved === "dark") document.documentElement.setAttribute("data-theme", "dark");
})();
</script>

<!-- ═══ Section 1: Pipeline Overview ═══ -->
<div id="slide-section-1">
<!-- Header -->
<div class="page-header">
    <h1>Driving Results with <span>AI</span><br>
        <span style="font-size:.55em;font-weight:500;color:var(--slate-500)">Corporate Data & AI Office</span></h1>
    <div style="display:flex;align-items:center;gap:12px">
        <div class="date">February 2026</div>
        <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()">
            <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zm8-5a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0118 10zM5 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 015 10zm11.95-4.95a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-12.73 9.9a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm12.73 0a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 111.06-1.06l1.06 1.06zm-12.73-9.9a.75.75 0 01-1.06 0L1.1 4.01a.75.75 0 111.06-1.06l1.06 1.06a.75.75 0 010 1.06zM10 7a3 3 0 100 6 3 3 0 000-6z"/></svg>
            <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style="display:none"><path fill-rule="evenodd" d="M7.455 2.004a.75.75 0 01.26.77 7 7 0 009.958 7.967.75.75 0 011.067.853A8.5 8.5 0 116.647 1.921a.75.75 0 01.808.083z" clip-rule="evenodd"/></svg>
        </button>
    </div>
</div>

<!-- KPI Strip (rendered from JSON) -->
<div class="kpi-strip" id="kpi-strip"></div>

<!-- Pipeline Board (rendered from JSON) -->
<div class="section-title">Initiative Pipeline</div>
<div class="pipeline-board" id="pipeline-board"></div>
</div>
<button class="export-btn" onclick="exportSlide('slide-section-1', 'pipeline-overview')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13.75 7h-3V1.5a.75.75 0 00-1.5 0V7h-3a.75.75 0 00-.53 1.28l3.75 3.75a.75.75 0 001.06 0l3.75-3.75A.75.75 0 0013.75 7zM3 13.5a.75.75 0 01.75.75v1.5c0 .138.112.25.25.25h12a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 0116 17.5H4A1.75 1.75 0 012.25 15.75v-1.5a.75.75 0 01.75-.75z"/></svg>
    Export Slide
</button>
<div style="clear:both"></div>

<!-- ═══ Section 2: Portfolio Overview ═══ -->
<div id="slide-section-2">
<!-- Portfolio Overview (rendered from JSON) -->
<div class="section-title">Portfolio Overview</div>
<table class="portfolio-table">
    <thead>
        <tr>
            <th>Status</th>
            <th>Use Case</th>
            <th>Department</th>
            <th>Headline Impact</th>
            <th>Owner</th>
        </tr>
    </thead>
    <tbody id="table-body"></tbody>
</table>
</div>
<button class="export-btn" onclick="exportSlide('slide-section-2', 'portfolio-overview')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13.75 7h-3V1.5a.75.75 0 00-1.5 0V7h-3a.75.75 0 00-.53 1.28l3.75 3.75a.75.75 0 001.06 0l3.75-3.75A.75.75 0 0013.75 7zM3 13.5a.75.75 0 01.75.75v1.5c0 .138.112.25.25.25h12a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 0116 17.5H4A1.75 1.75 0 012.25 15.75v-1.5a.75.75 0 01.75-.75z"/></svg>
    Export Slide
</button>
<div style="clear:both"></div>

<!-- ═══ Section 3: Highlights & Next Steps ═══ -->
<div id="slide-section-3">
<!-- Strategic Highlights (rendered from data) -->
<div class="section-title">Strategic Highlights</div>
<div class="highlights-row" id="highlights-row"></div>

<!-- Recommendations (rendered from data) -->
<div class="section-title">Recommended Next Steps</div>
<ul class="reco-list" id="reco-list"></ul>
</div>
<button class="export-btn" onclick="exportSlide('slide-section-3', 'highlights-and-next-steps')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M13.75 7h-3V1.5a.75.75 0 00-1.5 0V7h-3a.75.75 0 00-.53 1.28l3.75 3.75a.75.75 0 001.06 0l3.75-3.75A.75.75 0 0013.75 7zM3 13.5a.75.75 0 01.75.75v1.5c0 .138.112.25.25.25h12a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 0116 17.5H4A1.75 1.75 0 012.25 15.75v-1.5a.75.75 0 01.75-.75z"/></svg>
    Export Slide
</button>
<div style="clear:both"></div>

<!-- Footer (outside all sections) -->
<div class="page-footer">
    <span>Confidential &mdash; Internal Use Only</span>
    <span>AI Portfolio Executive Summary &mdash; February 2026</span>
</div>

<script>
(async function () {
    /* ── Data Source Toggle ──────────────────────────────────────
       Change this single value to switch where data comes from:
         "json"       → local file (data/use_cases.json)
         "smartsheet" → live from Smartsheet API via proxy
    ──────────────────────────────────────────────────────────── */
    const DATA_SOURCE = "smartsheet";
    const DATA_URLS = {
        json: "../data/use_cases.json",
        smartsheet: "/api/use-cases",
    };

    const resp = await fetch(DATA_URLS[DATA_SOURCE]);
    const data = await resp.json();
    const cases = data.use_cases;

    /* ── Helper: escape HTML entities ── */
    const esc = (s) => String(s || "").replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

    /* ── Status config ── */
    const STATUS_CONFIG = {
        "In Production":   { badge: "badge-prod", colClass: "col-prod" },
        "POC Done":        { badge: "badge-done", colClass: "col-done" },
        "POC In Progress": { badge: "badge-prog", colClass: "col-prog" },
    };
    const STATUS_ORDER = ["In Production", "POC Done", "POC In Progress"];

    /* ── Group by status ── */
    const grouped = {};
    STATUS_ORDER.forEach(s => { grouped[s] = []; });
    cases.forEach(c => { if (grouped[c.status]) grouped[c.status].push(c); });

    const prodItems  = grouped["In Production"]   || [];
    const doneItems  = grouped["POC Done"]         || [];
    const progItems  = grouped["POC In Progress"]  || [];

    /* ──────────────────────────────────────────────────────────────
       KPI Strip — compute everything from row data
    ────────────────────────────────────────────────────────────── */

    /* Extract dollar amounts from headline_impact text */
    function parseDollars(text) {
        const amounts = [];
        const rx = /\$([\d,.]+)\s*(K|M|B)/gi;
        let m;
        while ((m = rx.exec(text)) !== null) {
            let val = parseFloat(m[1].replace(/,/g, ""));
            const unit = m[2].toUpperCase();
            if (unit === "K") val *= 1_000;
            else if (unit === "M") val *= 1_000_000;
            else if (unit === "B") val *= 1_000_000_000;
            amounts.push(val);
        }
        return amounts;
    }

    /* Extract FTE counts from headline_impact text */
    function parseFTEs(text) {
        const rx = /(\d+)(?:\s*-\s*(\d+))?\s*FTEs?/gi;
        let lo = 0, hi = 0;
        let m;
        while ((m = rx.exec(text)) !== null) {
            lo += parseInt(m[1], 10);
            hi += parseInt(m[2] || m[1], 10);
        }
        return { lo, hi };
    }

    let totalDollars = 0;
    let fteLo = 0, fteHi = 0;
    let hasDollars = false, hasFTEs = false;

    cases.forEach(c => {
        const impact = c.headline_impact || "";
        const dollars = parseDollars(impact);
        if (dollars.length > 0) {
            hasDollars = true;
            totalDollars += dollars.reduce((a, b) => a + b, 0);
        }
        const fte = parseFTEs(impact);
        if (fte.lo > 0) {
            hasFTEs = true;
            fteLo += fte.lo;
            fteHi += fte.hi;
        }
    });

    /* Format aggregated dollar value */
    function formatDollars(val) {
        if (val >= 1_000_000_000) return "$" + (val / 1_000_000_000).toFixed(1).replace(/\.0$/, "") + "B+";
        if (val >= 1_000_000)     return "$" + (val / 1_000_000).toFixed(1).replace(/\.0$/, "") + "M+";
        if (val >= 1_000)         return "$" + (val / 1_000).toFixed(0) + "K+";
        return "$" + val.toFixed(0);
    }

    const dollarLabel = hasDollars ? formatDollars(totalDollars) : "See Details";
    const fteLabel    = hasFTEs ? (fteLo === fteHi ? fteLo + "+" : fteLo + "-" + fteHi + "+") : "See Details";

    const kpis = [
        { number: cases.length,              label: "Active Initiatives" },
        { number: dollarLabel,               label: "Est. Annual Impact" },
        { number: fteLabel,                  label: "FTE Savings Potential" },
        { number: prodItems.length + " Live", label: "In Production" },
    ];
    document.getElementById("kpi-strip").innerHTML = kpis.map(k =>
        `<div class="kpi-box">
            <div class="number">${esc(String(k.number))}</div>
            <div class="label">${esc(k.label)}</div>
        </div>`
    ).join("");

    /* ──────────────────────────────────────────────────────────────
       Pipeline Board
    ────────────────────────────────────────────────────────────── */
    document.getElementById("pipeline-board").innerHTML = STATUS_ORDER.map(status => {
        const items = grouped[status];
        const cfg = STATUS_CONFIG[status];
        const cards = items.map(c =>
            `<div class="pipeline-card">
                <div class="pipeline-card-name">${esc(c.name)}</div>
                <div class="pipeline-card-meta">
                    <span class="pipeline-card-dept">${esc(c.department)}</span>
                    <span class="pipeline-card-owner">${esc(c.owner)}</span>
                </div>
            </div>`
        ).join("");
        return `<div class="pipeline-col ${cfg.colClass}">
            <div class="pipeline-col-header">
                ${esc(status)}
                <span class="col-count">${items.length}</span>
            </div>
            <div class="pipeline-col-body">${cards}</div>
        </div>`;
    }).join("");

    /* ──────────────────────────────────────────────────────────────
       Portfolio Table
    ────────────────────────────────────────────────────────────── */
    const sorted = STATUS_ORDER.flatMap(s => cases.filter(c => c.status === s));
    document.getElementById("table-body").innerHTML = sorted.map(c => {
        const cfg = STATUS_CONFIG[c.status];
        return `<tr>
            <td><span class="badge ${cfg.badge}">${esc(c.status)}</span></td>
            <td><strong>${esc(c.name)}</strong></td>
            <td>${esc(c.department)}</td>
            <td>${esc(c.headline_impact)}</td>
            <td>${esc(c.owner)}</td>
        </tr>`;
    }).join("");

    /* ──────────────────────────────────────────────────────────────
       Strategic Highlights — auto-generated from row data
    ────────────────────────────────────────────────────────────── */
    function buildHighlightCards() {
        const cards = [];

        /* Card 1 — In Production */
        if (prodItems.length > 0) {
            const names = prodItems.map(c => c.name).join(", ");
            const snippets = prodItems
                .filter(c => c.headline_impact)
                .map(c => `<strong>${esc(c.name)}</strong>: ${esc(c.headline_impact)}`)
                .join(". ");
            cards.push({
                stat: prodItems.length + " Live",
                title: "In Production",
                body: snippets || `${names} currently deployed across the organization.`,
            });
        }

        /* Card 2 — POC Done / Ready to Scale */
        if (doneItems.length > 0) {
            /* Find items with quantified dollar impact */
            const quantified = doneItems.filter(c => /\$/.test(c.headline_impact || ""));
            const totalImpact = [];
            quantified.forEach(c => {
                const d = parseDollars(c.headline_impact || "");
                totalImpact.push(...d);
            });
            const impactSum = totalImpact.reduce((a, b) => a + b, 0);
            const stat = impactSum > 0 ? formatDollars(impactSum) : doneItems.length + " Ready";
            const qNames = quantified.map(c => c.name).join(", ");
            const body = impactSum > 0
                ? `${quantified.length} completed POCs (${esc(qNames)}) with combined quantified annual savings ready for production investment.`
                : `${doneItems.length} completed POCs ready for production deployment across ${[...new Set(doneItems.map(c => c.department))].length} departments.`;
            cards.push({ stat, title: "Ready-to-Scale POCs", body });
        }

        /* Card 3 — POC In Progress / Active Pipeline */
        if (progItems.length > 0) {
            const names = progItems.map(c => c.name).join(", ");
            const depts = [...new Set(progItems.map(c => c.department).filter(Boolean))];
            cards.push({
                stat: progItems.length + " Active",
                title: "Active Pipeline",
                body: `${esc(names)} currently in development across ${depts.length} department${depts.length !== 1 ? "s" : ""}.`,
            });
        }

        return cards;
    }

    const highlights = buildHighlightCards();
    document.getElementById("highlights-row").innerHTML = highlights.map(h =>
        `<div class="highlight-card">
            <div class="stat">${h.stat}</div>
            <h4>${esc(h.title)}</h4>
            <p>${h.body}</p>
        </div>`
    ).join("");

    /* ──────────────────────────────────────────────────────────────
       Recommended Next Steps — auto-generated from data patterns
    ────────────────────────────────────────────────────────────── */
    function buildRecommendations() {
        const recos = [];

        /* 1. Deploy completed POCs */
        if (doneItems.length > 0) {
            const quantified = doneItems.filter(c => /\$/.test(c.headline_impact || ""));
            const dollarVals = [];
            quantified.forEach(c => dollarVals.push(...parseDollars(c.headline_impact || "")));
            const total = dollarVals.reduce((a, b) => a + b, 0);
            const valStr = total > 0 ? ` &mdash; combined ${formatDollars(total)} annual value with clear ROI` : "";
            recos.push(`<strong>Prioritize production deployment</strong> of the ${doneItems.length} completed POCs${valStr}`);
        }

        /* 2. Assign owners to TBD items */
        const tbdOwners = cases.filter(c => !c.owner || /^TBD$/i.test(c.owner.trim()));
        if (tbdOwners.length > 0) {
            const names = tbdOwners.map(c => c.name).join(", ");
            recos.push(`<strong>Assign dedicated owners</strong> to ${tbdOwners.length} initiative${tbdOwners.length > 1 ? "s" : ""} (${esc(names)}) to maintain momentum`);
        }

        /* 3. Quantify unscored items */
        const noImpact = cases.filter(c => !c.headline_impact || c.headline_impact.trim() === "");
        if (noImpact.length > 0) {
            const names = noImpact.map(c => c.name).join(", ");
            recos.push(`<strong>Quantify business impact</strong> for ${noImpact.length} initiative${noImpact.length > 1 ? "s" : ""} (${esc(names)}) to support investment decisions`);
        }

        /* 4. Track production ROI */
        if (prodItems.length > 0) {
            const names = prodItems.map(c => c.name).join(", ");
            recos.push(`<strong>Track realized vs. estimated savings</strong> for production systems (${esc(names)}) to build confidence for future investments`);
        }

        /* 5. Governance at scale */
        if (cases.length > 10) {
            recos.push(`<strong>Strengthen AI governance framework</strong> to scale from ${cases.length} to ${cases.length + 10}+ initiatives with consistent quality and risk management`);
        }

        /* 6. Monitor active POCs */
        if (progItems.length > 0) {
            const names = progItems.map(c => c.name).join(", ");
            recos.push(`<strong>Monitor active POCs</strong> (${esc(names)}) and set milestones to accelerate time-to-production`);
        }

        return recos;
    }

    const recos = buildRecommendations();
    document.getElementById("reco-list").innerHTML = recos.map(r =>
        `<li>${r}</li>`
    ).join("");

})();
</script>

<!-- ═══ Theme Toggle Logic ═══ -->
<script>
function toggleTheme() {
    const html = document.documentElement;
    const isDark = html.getAttribute("data-theme") === "dark";
    if (isDark) {
        html.removeAttribute("data-theme");
        localStorage.setItem("theme", "light");
    } else {
        html.setAttribute("data-theme", "dark");
        localStorage.setItem("theme", "dark");
    }
    updateThemeIcon();
}

function updateThemeIcon() {
    const isDark = document.documentElement.getAttribute("data-theme") === "dark";
    const sun = document.getElementById("theme-icon-sun");
    const moon = document.getElementById("theme-icon-moon");
    if (sun && moon) {
        sun.style.display = isDark ? "none" : "block";
        moon.style.display = isDark ? "block" : "none";
    }
}

/* Set correct icon on load */
updateThemeIcon();
</script>

<!-- ═══ Slide Export Logic ═══ -->
<script>
async function exportSlide(sectionId, filename) {
    const SLIDE_W = 1920;
    const SLIDE_H = 1080;
    const PADDING = 60;       /* inner padding inside the slide frame */

    const section = document.getElementById(sectionId);
    if (!section) return;

    /* Disable button while exporting */
    const btn = event.currentTarget;
    const origLabel = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" style="animation:spin 1s linear infinite"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.451a.75.75 0 000-1.5H4.5a.75.75 0 00-.75.75v3.75a.75.75 0 001.5 0v-1.578l.164.152a7 7 0 0011.712-3.138.75.75 0 00-1.449-.396zm.376-5.174a.75.75 0 00-1.5 0v1.578l-.164-.152a7 7 0 00-11.712 3.138.75.75 0 101.449.396 5.5 5.5 0 019.201-2.466l.312.311h-2.451a.75.75 0 000 1.5H15.5a.75.75 0 00.75-.75v-3.75z" clip-rule="evenodd"/></svg> Exporting\u2026';

    try {
        /* ── 1. Create off-screen stage ── */
        const isDark = document.documentElement.getAttribute("data-theme") === "dark";
        const bgColor = isDark ? "#0b1120" : "#ffffff";

        const stage = document.createElement("div");
        stage.style.cssText = `
            position: fixed; left: -9999px; top: 0;
            width: ${SLIDE_W}px; height: ${SLIDE_H}px;
            background: ${bgColor}; overflow: hidden; z-index: -1;
            display: flex; align-items: center; justify-content: center;
        `;
        /* Carry theme attribute so CSS variables apply inside the clone */
        if (isDark) stage.setAttribute("data-theme", "dark");
        document.body.appendChild(stage);

        /* ── 2. Clone the section ── */
        const clone = section.cloneNode(true);
        clone.removeAttribute("id");

        /* Remove any export buttons and theme toggle from the clone */
        clone.querySelectorAll(".export-btn, .theme-toggle").forEach(b => b.remove());

        /* ── 3. Measure natural size in a temp container ── */
        const measurer = document.createElement("div");
        measurer.style.cssText = `
            position: fixed; left: -9999px; top: 0;
            width: ${SLIDE_W - PADDING * 2}px;
            visibility: hidden;
        `;
        measurer.appendChild(clone.cloneNode(true));
        document.body.appendChild(measurer);

        /* Wait for layout to settle */
        await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));

        const naturalW = measurer.scrollWidth;
        const naturalH = measurer.scrollHeight;
        document.body.removeChild(measurer);

        /* ── 4. Compute scale to fit 16:9 with padding ── */
        const availW = SLIDE_W - PADDING * 2;
        const availH = SLIDE_H - PADDING * 2;
        const scale = Math.min(availW / naturalW, availH / naturalH, 1);

        /* ── 5. Place clone in stage with transform ── */
        const inner = document.createElement("div");
        inner.style.cssText = `
            width: ${naturalW}px;
            transform: scale(${scale});
            transform-origin: top left;
        `;
        inner.appendChild(clone);

        /* Center wrapper */
        const wrapper = document.createElement("div");
        const scaledW = naturalW * scale;
        const scaledH = naturalH * scale;
        wrapper.style.cssText = `
            position: absolute;
            left: ${(SLIDE_W - scaledW) / 2}px;
            top: ${(SLIDE_H - scaledH) / 2}px;
        `;
        wrapper.appendChild(inner);
        stage.appendChild(wrapper);

        /* Wait for layout */
        await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));

        /* ── 6. Capture with html2canvas ── */
        const canvas = await html2canvas(stage, {
            width: SLIDE_W,
            height: SLIDE_H,
            scale: 1,
            useCORS: true,
            backgroundColor: bgColor,
            logging: false,
        });

        /* ── 7. Download as PNG ── */
        canvas.toBlob(function (blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = filename + ".png";
            a.click();
            URL.revokeObjectURL(url);
        }, "image/png");

        /* ── 8. Cleanup ── */
        document.body.removeChild(stage);

    } catch (err) {
        console.error("Export failed:", err);
        alert("Export failed. Check the browser console for details.");
    } finally {
        btn.disabled = false;
        btn.innerHTML = origLabel;
    }
}
</script>

<!-- Spinner keyframe for export button -->
<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

</body>
</html>
